###平均负载

>单位时间内，系统处于可运行状态和不可运行状态的平均进程数，也就是平均活跃进程数

查看系统cpu数量

```bash
$ grep 'model name' /proc/cpuinfo | wc -l
1
```

查看系统的平均负载

```bash
$ uptime
02:34:03 up 2 days, 20:14,  1 user,  load average: 0.63, 0.83, 0.88
```

| 系统当前时间 | 系统运行时间     | 正在登陆的用户数 | 过去1分钟，5分钟，15分钟的平均负载 |
| ------------ | ---------------- | ---------------- | ---------------------------------- |
| 02:34:03 up  | up 2 days, 20:14 | 1 user           | load average: 0.63, 0.83, 0.88     |

- 如果1分钟，5分钟，15分钟的三个值基本相同，或者相差不大，那说明系统运行很稳定
- 如果1分钟的值远小于15分钟的值，就说明系统最近1分钟的负载在减少，而过去15分钟却有很大的负载。
- 反过来，如果 1 分钟的值远大于 15 分钟的值，就说明最近 1 分钟的负载在增加，这种增加有可能只是 临时性的，也有可能还会持续增加下去，所以就需要持续观察。一旦 1 分钟的平均负载接近或超过了 CPU 的个数，就意味着系统正在发生过载的问题。

常用工具

| stress  | linux压力测试工具        |
| ------- | ------------------------ |
| sysstat | 用来监控和分析系统的性能 |

常用命令

- mpstat 是一个常用的多核 CPU 性能分析工具，用来实时查看每个 CPU 的性能指标，以及所有 CPU 的平均指标。 
- pidstat 是一个常用的进程性能分析工具，用来实时查看进程的 CPU、内存、I/O 以及上下文切换等 性能指标。 

案列

```bash
# -P ALL 表示监控所有 CPU，后面数字 5 表示间隔 5 秒后输出一组数据
$ mpstat -P ALL 5
Linux 4.15.0 (ubuntu) 09/22/18 _x86_64_ (2 CPU)
13:30:06     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
13:30:11     all   50.05    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   49.95
13:30:11       0    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
13:30:11       1  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00

```

```bash
# 间隔 5 秒后输出一组数据
$ pidstat -u 5 1
13:37:07      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
13:37:12        0      2962  100.00    0.00    0.00    0.00  100.00     1  stress

```

